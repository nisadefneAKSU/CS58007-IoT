<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Room 101 Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=JetBrains+Mono&display=swap');
        body { background: #020617; font-family: 'JetBrains Mono', monospace; color: white; transition: all 0.5s ease; }
        .cyber { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .glow-red { box-shadow: 0 0 30px rgba(239, 68, 68, 0.3); border-color: #ef4444 !important; }
        .offline-mode { filter: grayscale(1) contrast(0.5); opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body class="p-8">
    <h1 class="cyber text-3xl text-blue-500 mb-8 uppercase tracking-tighter">Node: Room_101</h1>
    
    <div id="ui-container" class="grid grid-cols-12 gap-8">
        <div id="main-card" class="col-span-12 lg:col-span-8 glass rounded-3xl p-12 flex flex-col items-center justify-center transition-all duration-500">
            <svg viewBox="0 0 400 400" class="w-64">
                <rect id="room-box" x="20" y="20" width="360" height="360" rx="20" fill="none" stroke="#3b82f6" stroke-width="4" />
                <text x="50%" y="50%" text-anchor="middle" class="cyber fill-white/10 text-4xl font-bold">101</text>
            </svg>
            <h2 id="occ-text" class="cyber text-4xl mt-8 text-slate-600 tracking-[0.3em]">VACANT</h2>
        </div>

        <div class="col-span-12 lg:col-span-4 space-y-4">
            <div class="glass p-6 rounded-2xl flex justify-between"><span>Temp</span><span id="ui-temp" class="text-blue-400">--</span></div>
            <div class="glass p-6 rounded-2xl flex justify-between"><span>Light</span><span id="ui-light" class="text-yellow-400">--</span></div>
            <div class="glass p-6 rounded-2xl flex justify-between"><span>PIR</span><span id="ui-pir" class="text-slate-400">--</span></div>
            <div class="glass p-6 rounded-2xl text-center"><span id="ui-status" class="cyber text-xs">OFFLINE</span></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/status'; 

        async function update() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                
                if (data.length > 0) {
                    const room = data[0];
                    const container = document.getElementById('ui-container');
                    const status = document.getElementById('ui-status');

                    // 1. Check Online Status
                    if (!room.is_online) {
                        container.classList.add('offline-mode');
                        status.innerText = "PI DISCONNECTED";
                        status.className = "cyber text-xs text-red-500 animate-pulse";
                        return; // Stop updating values if offline
                    } else {
                        container.classList.remove('offline-mode');
                        status.innerText = "CONNECTED";
                        status.className = "cyber text-xs text-emerald-500";
                    }

                    // 2. Update Text Data
                    document.getElementById('ui-temp').innerText = (room.temperature || 0).toFixed(1) + "Â°C";
                    document.getElementById('ui-light').innerText = (room.light || 0).toFixed(0) + " lx";
                    document.getElementById('ui-pir').innerText = room.pir ? "MOTION" : "STILL";
                    
                    const box = document.getElementById('room-box');
                    const card = document.getElementById('main-card');
                    const txt = document.getElementById('occ-text');

                    // 3. Occupancy Visuals
                    if (room.is_occupied) {
                        box.setAttribute('stroke', '#ef4444');
                        box.setAttribute('fill', 'rgba(239, 68, 68, 0.1)');
                        card.classList.add('glow-red');
                        txt.innerText = "OCCUPIED";
                        txt.style.color = "#ef4444";
                    } else {
                        box.setAttribute('stroke', '#3b82f6');
                        box.setAttribute('fill', 'none');
                        card.classList.remove('glow-red');
                        txt.innerText = "VACANT";
                        txt.style.color = "#475569";
                    }
                }
            } catch (e) { 
                document.getElementById('ui-status').innerText = "SERVER OFFLINE";
                document.getElementById('ui-status').className = "cyber text-xs text-red-600";
            }
        }
        setInterval(update, 2000);
    </script>
</body>
</html>